# Migration container for Prisma
FROM node:24-alpine

WORKDIR /app

# Copy root package files for workspaces
COPY package.json package-lock.json ./

# Copy backend package.json
COPY backend/package.json ./backend/

# Copy prisma schema
COPY backend/prisma ./backend/prisma

# Install dependencies
RUN npm ci -w @soeji/backend

WORKDIR /app/backend

# Run db push to sync schema (creates tables if not exist)
CMD ["npx", "prisma", "db", "push", "--skip-generate"]
